
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../milestones/">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.14">
    
    
      
        <title>architecture - Cloud Gaming API Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.10ba22f1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-orange" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#architecture" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Cloud Gaming API Documentation" class="md-header__button md-logo" aria-label="Cloud Gaming API Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cloud Gaming API Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              architecture
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-orange" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="orange" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Cloud Gaming API Documentation" class="md-nav__button md-logo" aria-label="Cloud Gaming API Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Cloud Gaming API Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../endpoint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    endpoint
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../milestones/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    milestones
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    architecture
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    architecture
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#service-details" class="md-nav__link">
    <span class="md-ellipsis">
      Service Details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Service Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user" class="md-nav__link">
    <span class="md-ellipsis">
      User
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#games" class="md-nav__link">
    <span class="md-ellipsis">
      Games
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auth" class="md-nav__link">
    <span class="md-ellipsis">
      Auth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session" class="md-nav__link">
    <span class="md-ellipsis">
      Session
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#certificate-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Certificate Manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Session Manager
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Database Schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#games_1" class="md-nav__link">
    <span class="md-ellipsis">
      Games
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flowchart" class="md-nav__link">
    <span class="md-ellipsis">
      Flowchart
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Flowchart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#session-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Session Creation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mutual-tls" class="md-nav__link">
    <span class="md-ellipsis">
      Mutual TLS
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#service-details" class="md-nav__link">
    <span class="md-ellipsis">
      Service Details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Service Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user" class="md-nav__link">
    <span class="md-ellipsis">
      User
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#games" class="md-nav__link">
    <span class="md-ellipsis">
      Games
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auth" class="md-nav__link">
    <span class="md-ellipsis">
      Auth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session" class="md-nav__link">
    <span class="md-ellipsis">
      Session
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#certificate-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Certificate Manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Session Manager
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Database Schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#games_1" class="md-nav__link">
    <span class="md-ellipsis">
      Games
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flowchart" class="md-nav__link">
    <span class="md-ellipsis">
      Flowchart
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Flowchart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#session-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Session Creation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mutual-tls" class="md-nav__link">
    <span class="md-ellipsis">
      Mutual TLS
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="architecture">Architecture</h1>
<p>This API used <code>one database per service pattern</code>. The database used is combination of SQL and No - SQL. For SQL, it used PostgreSQL and NoSQL it used MongoDB. </p>
<p><img alt="" src="../img/arsi_backend.drawio.png" /></p>
<h2 id="service-details">Service Details</h2>
<h3 id="user">User</h3>
<p>This service handle <code>/v1/account</code> endpoint. This service deal with account related stuff</p>
<h3 id="games">Games</h3>
<p>This service handle <code>/v1/games</code> endpoint. This service handle user game collections</p>
<h3 id="auth">Auth</h3>
<p>This service handle <code>/v1/auth</code> endpoint. This service handle client authorization to access specific endpoint</p>
<h3 id="session">Session</h3>
<p>This service handle <code>/v1/session</code>endpoint. This service is a middleware between client and session manager.</p>
<h3 id="certificate-manager">Certificate Manager</h3>
<p>This service handle certificate distribution to all the service above for internal HTTPS communications and internal service authentication. </p>
<h3 id="session-manager">Session Manager</h3>
<p>This is the service that handle VM creation automation. </p>
<h2 id="database-schema">Database Schema</h2>
<h3 id="games_1">Games</h3>
<p><strong>This the table schema of games service database.</strong>  </br>
<img alt="" src="../img/game_db_design.drawio.png" /></p>
<p>There are three tables; <strong>games</strong>, <strong>storage_location</strong>, and <strong>user_games_collections</strong>. <em>games</em> is a table that store all supported games. This table hold information on the name of the games, the game icon, and the display picture (icon but big), and <strong>storage_id</strong> which point to <em>storage_location</em> table. <em>storage_location</em> table give information on to retrieve game from the storage location. This information include the protocol, ip/host, port (if needed), and location or endpoint.</p>
<h2 id="flowchart">Flowchart</h2>
<h3 id="session-creation">Session Creation</h3>
<p><img alt="" src="../img/session-creation-flow.drawio.png" /></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>For internal only endpoint, mTLS (mutual TLS) is required, the API won't accept any request with invalid client certificate. If you are developing service that need access to internal endpoint, please refer the <a href="https://cloud-gaming-ta.github.io/api-docs/v1/architecture/#mutual-tls">mTLS section</a> on this documents.  </p>
</div>
<h2 id="mutual-tls">Mutual TLS</h2>
<p>The API protected internal endpoint by using mutual TLS . In Mutual TLS, each party must provide a valid certificate. Valid certificate in this case, is a certificate that were signed by the <strong>internal PKI</strong>. </p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Please refer to <a href="https://cloud-gaming-ta.github.io/api-docs/v1/endpoint">endpoint documentation</a> for details on which endpoint is internal only</p>
</div>
<p>In order for your application to have a valid certificate, create a certificate sign request (csr) file, and send that request to the PKI API (Certificate - Manager). Then add the CA of the certificate manager to the trusted certificate, either on OS level or application level. Below is an example on how to do it on Linux (openssl and curl required): 
1. Create a RSA private key (2048 bit)
<div class="language-shell highlight"><span class="filename">linux</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>$<span class="w"> </span>openssl<span class="w"> </span>genpkey<span class="w"> </span>-algorithm<span class="w"> </span>RSA<span class="w"> </span>-out<span class="w"> </span>private_key.pem<span class="w"> </span>-pkeyopt<span class="w"> </span>rsa_keygen_bits:2048
</span></code></pre></div>
2. Create a CSR (Certificate Sign Request) File 
<div class="language-shell highlight"><span class="filename">linux</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">UNIT</span><span class="o">=</span><span class="s2">&quot;/C=</span><span class="si">${</span><span class="nv">COUNTRY</span><span class="si">}</span><span class="s2">/ST=</span><span class="si">${</span><span class="nv">STATE</span><span class="si">}</span><span class="s2">/L=</span><span class="si">${</span><span class="nv">LOCALITY</span><span class="si">}</span><span class="s2">/O=</span><span class="si">${</span><span class="nv">ORGANIZATION</span><span class="si">}</span><span class="s2">/OU=</span><span class="si">${</span><span class="nv">ORG_UNIT</span><span class="si">}</span><span class="s2">/CN=</span><span class="si">${</span><span class="nv">COMMON_NAME</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">SUBJECT_ALT_NAME</span><span class="o">=</span><span class="s2">&quot;DNS.1:</span><span class="si">${</span><span class="nv">SERVICE_NAME</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>$<span class="w"> </span>openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span>-key<span class="w"> </span>private_key.pem<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span>-subj<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">UNIT</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span>-reqexts<span class="w"> </span>SAN<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span>-config<span class="w"> </span>&lt;<span class="o">(</span>cat<span class="w"> </span>/etc/ssl/openssl.cnf<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">        </span>&lt;<span class="o">(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;\n[SAN]\nsubjectAltName=</span><span class="si">${</span><span class="nv">SUBJECT_ALT_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">))</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span>-out<span class="w"> </span><span class="nv">$CSR_FILE_PATH</span>
</span></code></pre></div></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>I don't know if <code>&lt;(printf "\n[SAN]\nsubjectAltName=${SUBJECT_ALT_NAME}")</code> available on Windows. </p>
</div>
<p>Please change the placehoder (or add environment variables) with the proper values. </p>
<ol start="3">
<li>Send the csr to the cert manager api
<div class="language-shell highlight"><span class="filename">linux</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>$<span class="w"> </span>curl<span class="w"> </span>-k<span class="w"> </span>https://<span class="nv">$PKI_HOST</span>/certificate<span class="w"> </span>-o<span class="w"> </span>cert/root-ca.crt
</span></code></pre></div>
This will save the signed CA for your service in <strong>cert/root-ca.crt</strong>. Use this in your application. </li>
</ol>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>PKI host is  34.101.181.190:5500</p>
</div>
<ol start="4">
<li>
<p>Get the Root Certificate
<div class="language-shell highlight"><span class="filename">linux</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>$<span class="w"> </span>curl<span class="w"> </span>-k<span class="w"> </span>-v<span class="w"> </span>-F<span class="w"> </span><span class="s2">&quot;csr=@</span><span class="si">${</span><span class="nv">CSR_FILE_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>https://<span class="nv">$PKI_HOST</span>/certificate/sign<span class="w"> </span>-o<span class="w"> </span><span class="nv">$CERT_FILE_PATH</span>
</span></code></pre></div>
This will save the Root CA in <code>CERT_FILE_PATH</code>.  </p>
</li>
<li>
<p>(Optional) Encrypt your private key in PKCS8 Format
<div class="language-shell highlight"><span class="filename">linux</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>$<span class="w"> </span>openssl<span class="w"> </span>pkcs8<span class="w"> </span>-topk8<span class="w"> </span>-inform<span class="w"> </span>PEM<span class="w"> </span>-outform<span class="w"> </span>PEM<span class="w"> </span>-in<span class="w"> </span>private_key.pem<span class="w"> </span>-out<span class="w"> </span><span class="nv">$PRIVATE_KEY_PATH</span><span class="w"> </span>-passout<span class="w"> </span>file:/tmp/passphrase
</span></code></pre></div>
This will encrypt the private key using passphrase specified in the file <strong>/tmp/passphrase</strong>. </p>
</li>
</ol>
<p>Now, when you want to create a request, provide the certificate. if you create a valid certificate, you won't get <strong>access_denied 403 Unauthroized</strong> error. </p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.bd41221c.min.js"></script>
      
    
  </body>
</html>